<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="https://studentvisiontc.github.io/SVTC-Images/SV%20Circle%20logo.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <title>S.V.T.C. Professional Test Portal</title>
    <style>
        :root {
            --primary: #00008B;
            --accent: #ffa500;
            --bg: #ffffff;
            --text: #0f172a;
            --border: #e2e8f0;
            --success: #10b981;
            --danger: #ef4444;
            --id-bg: #fef08a;
        }

        * { font-family: 'Roboto Slab', serif; box-sizing: border-box; margin: 0; padding: 0; }
        body { background-color: var(--bg); color: var(--text); overflow-x: hidden; }

        main { width: 100%; padding: 0 10px; }

        .subject-pane { padding: 10px 0; border-bottom: 2px solid #f1f5f9; }
        .sub-head-row { display: flex; align-items: center; gap: 10px; margin-bottom: 5px; }
        .sub-head-row i { font-size: 20px; color: var(--accent); }
        .sub-head-row h3 { font-size: 22px; font-weight: 800; color: var(--primary); text-transform: uppercase; }
        
        .sub-inspiration { font-size: 14.5px; line-height: 1.7; color: #475569; margin-bottom: 8px; text-align: left; }

        .item-row { 
            display: flex; flex-direction: column; background: white; 
            border: 1px solid var(--border); border-radius: 6px; 
            margin-bottom: 8px; overflow: hidden; width: 100%; 
        }
        .item-top { 
            display: flex; align-items: center; justify-content: space-between; 
            padding: 8px 15px; background: #fafafa; border-bottom: 1px solid #f1f5f9;
        }
        .item-month { font-size: 11px; font-weight: 900; color: var(--danger); width: 80px; }
        
        .item-meta { display: flex; gap: 12px; flex: 1; justify-content: center; flex-wrap: wrap; }
        .item-meta span { font-size: 10px; font-weight: 700; color: var(--primary); display: flex; align-items: center; gap: 5px; }
        
        .item-scores { display: flex; align-items: center; gap: 8px; }
        .box-grid { display: flex; gap: 4px; }
        .box-unit { width: 28px; height: 20px; border: 1px solid var(--border); border-radius: 4px; font-size: 10px; font-weight: 800; display: flex; align-items: center; justify-content: center; background: white; color: var(--primary); }
        .score-lbl { font-size: 11px; font-weight: 900; color: var(--primary); text-transform: uppercase; }

        .item-bottom { padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; background: #f0f9ff; border-top: 1px solid #e2e8f0; }
        .item-topic-name { font-size: 14.5px; font-weight: 700; color: #1e293b; }
        .item-topic-name span { color: var(--primary); font-size: 11px; text-transform: uppercase; margin-right: 6px; opacity: 0.7; }
        
        .btn-take { 
            background: var(--primary); color: white; border: none; padding: 8px 20px; 
            border-radius: 5px; font-size: 11px; font-weight: 800; text-transform: uppercase; 
            cursor: pointer; transition: 0.2s;
        }
        .btn-take:hover { background: #0000cd; transform: scale(1.02); }

        #exam-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff; display: none; z-index: 9999; flex-direction: column; }
        .exam-header { 
            padding: 10px 15px; border-bottom: 2px solid var(--primary); 
            display: flex; justify-content: space-between; align-items: center; 
            background: white; position: sticky; top: 0;
        }
        .exam-header h2 { font-size: 14px; color: #64748b; font-weight: 600; font-style: italic; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 40%; }

        .timer-wrapper { display: flex; align-items: center; gap: 8px; }
        .timer-label { font-size: 12px; font-weight: 800; color: var(--primary); text-transform: uppercase; }
        .timer-box { display: flex; gap: 2px; background: #0f172a; padding: 4px 8px; border-radius: 6px; align-items: center; border: 1px solid var(--primary); }
        .digit { color: white; font-size: 16px; font-weight: 900; width: 14px; text-align: center; }
        .timer-sep { color: white; font-weight: 900; font-size: 16px; margin: 0 2px; }
        .timer-urgent .digit { color: var(--danger); animation: pulse 1s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

        .exit-icon { font-size: 24px; color: var(--danger); cursor: pointer; margin-left: 12px; transition: 0.2s; }
        .exit-icon:hover { transform: scale(1.15); }

        .exam-content { padding: 20px; flex: 1; overflow-y: auto; background: #fbfcfd; }
        .question-card { 
            background: white; padding: 15px; border-radius: 8px; margin-bottom: 12px; 
            border: 1px solid var(--border);
        }
        
        .q-num-badge {
            background-color: var(--id-bg);
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: 900;
            margin-right: 8px;
            color: var(--primary);
            border: 1px solid #eab308;
        }

        .q-text { font-size: 16px; font-weight: 700; margin-bottom: 12px; line-height: 1.6; color: var(--text); }
        .options-list { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .option-item { 
            padding: 12px; border: 1.5px solid var(--border); border-radius: 8px; 
            cursor: pointer; font-size: 14px; font-weight: 600; transition: 0.2s;
        }
        .option-item:hover { border-color: var(--primary); background: #f0f7ff; }
        .option-item.selected { background: var(--primary); color: white; border-color: var(--primary); }
        
        .footer-action-area { padding: 30px; display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; }
        .btn-submit { 
            background: linear-gradient(135deg, #10b981 0%, #059669 100%); 
            color: white; border: none; padding: 15px 50px; border-radius: 50px; 
            font-weight: 900; cursor: pointer; font-size: 18px; 
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3); transition: 0.3s; 
        }
        .btn-submit:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(16, 185, 129, 0.4); }

        .result-screen { text-align: center; padding: 40px 15px; max-width: 650px; margin: 0 auto; }
        .score-circle { 
            width: 140px; height: 140px; border-radius: 50%; border: 10px solid var(--success); 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            margin: 0 auto 20px; background: white; box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        .score-val { font-size: 36px; font-weight: 900; color: var(--success); }
        .feedback-text { font-size: 24px; font-weight: 800; margin-bottom: 10px; }
        .feedback-msg { font-size: 15px; color: #475569; margin-bottom: 30px; line-height: 1.6; }

        .result-buttons { display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; }
        .btn-res-action { 
            padding: 14px 30px; border-radius: 50px; font-weight: 800; cursor: pointer; border: none; font-size: 15px; transition: 0.2s;
            display: flex; align-items: center; gap: 10px;
        }
        .btn-res-review { background: var(--primary); color: white; }
        .btn-res-review:hover { background: #0000cd; transform: translateY(-2px); }
        .btn-res-close { background: #64748b; color: white; }
        .btn-res-close:hover { background: #475569; transform: translateY(-2px); }

        .review-card { background: white; padding: 12px; border-bottom: 1px solid var(--border); text-align: left; }
        .ans-row { font-size: 13px; margin-top: 5px; }
        .ans-correct { color: var(--success); font-weight: 800; }
        .ans-wrong { color: var(--danger); font-weight: 800; text-decoration: line-through; }
        .explanation-box { background: #fffbeb; border-left: 5px solid var(--accent); padding: 12px; font-size: 13px; margin-top: 10px; color: #92400e; border-radius: 4px; line-height: 1.6; }

        @media (max-width: 768px) {
            .options-list { grid-template-columns: 1fr; }
            .item-meta { justify-content: center; gap: 6px; }
            .timer-label { display: none; }
            .item-top { flex-direction: column; gap: 8px; }
            .item-meta { width: 100%; }
        }
    </style>
</head>
<body>

<main id="subjects-container"></main>

<div id="exam-overlay">
    <div class="exam-header">
        <h2 id="modal-topic-title">Loading...</h2>
        <div class="timer-wrapper">
            <span class="timer-label">Time Remaining:</span>
            <div id="timer-group" class="timer-box">
                <div class="digit" id="m1">0</div>
                <div class="digit" id="m2">0</div>
                <div class="timer-sep">:</div>
                <div class="digit" id="s1">0</div>
                <div class="digit" id="s2">0</div>
            </div>
            <i class="fa-solid fa-circle-xmark exit-icon" title="Exit Exam" onclick="closeExam()"></i>
        </div>
    </div>
    <div id="modal-body" class="exam-content"></div>
</div>

<script>
    const API_URL = "https://script.google.com/macros/s/AKfycbxJpqsKOrkKLD2k40wip1hH0IJ0h2VFTz6VTFjPRmYcLTo2mPrBEv-meBWoGe05CbPT/exec";

    const subjectsData = [
        { id: 1, name: "Number Systems", icon: "fa-hashtag", time: "45 MINS", 
          passage: "Numbers are the incredible building blocks of our reality! By mastering Number Systems in Grade 3, you are learning the secret code that scientists, astronauts, and engineers use every day to solve the world's biggest mysteries. This skill is your ticket to future high-tech careers like Data Science and Artificial Intelligence, where understanding the logic of thousands and millions makes you a superhero. It trains your brain to be super-precise and organized, helping you handle any complex challenge with ease and confidence. Learning this now ensures that your mathematical foundation is strong enough to build a brilliant future in any field you choose. Every number you understand today opens a door to a new discovery tomorrow. Let's start this journey of becoming a number genius together and pave the way for a world where you lead with logic and precision. This knowledge will set you apart as a detail-oriented individual in any future professional endeavor.",
          topics: ["Place Value Mastery", "Number Types & Logic", "Roman Numerals", "Rounding Off Rules", "Successor & Predecessor", "Expanded Form Mastery", "Number Comparison", "Digit Formation Puzzles", "Fundamental Arithmetic Rules", "Divisibility Tests"] },
        { id: 2, name: "Mental Ability", icon: "fa-eye", time: "45 MINS", 
          passage: "Mental Ability is the ultimate 'Brain Gym' designed for the world's sharpest 3rd graders! This subject trains your eyes to see patterns that others miss and your mind to solve difficult puzzles in a flash. Mastering these logic skills is essential for future innovators like Game Designers, Master Detectives, and Creative Architects. Every challenge you face here expands your brain's processing speed, making you a faster thinker and a smarter problem-solver in school and beyond. It teaches you how to look at the world differently, finding solutions where others only see confusion. Start your brain training today and become a logic champion! With constant practice, you will notice that your brain can handle multiple thoughts at once, helping you multi-task like a pro. Your future as a sharp-minded leader begins with these visual and logical exercises that build incredible cognitive resilience.",
          topics: ["Odd-Man Out Logic", "Figure Matching", "Pattern Completion", "Figure Series Analysis", "Analogy Puzzles", "Mirror Imaging", "Paper Folding Logic", "Embedded Figures", "Space Visualization", "Geometrical Completion"] },
        { id: 3, name: "Applied Arithmetic", icon: "fa-calculator", time: "45 MINS", 
          passage: "Applied Arithmetic is where math meets the real, exciting world around you! For 3rd-grade students, this is the toolkit you need to lead successful businesses, build massive bridges, or manage global resources. This subject prepares you for future roles as successful Entrepreneurs, Civil Engineers, and top-tier CEOs who make big decisions every day. It improves your practical sense of money, time, and measurement, giving you the power to handle real-life situations with perfect accuracy. By learning how numbers work in the real world, you become a confident leader who can build anything and manage everything with mathematical brilliance. Your journey into the world of finance and construction starts here, where every calculation you make brings a new idea to life and solves a practical problem for the community. These skills ensure you grow into a person who can navigate life's complexities with ease.",
          topics: ["Unitary Method", "Profit & Loss Logic", "Simple Interest Mastery", "Time & Work Dynamics", "Speed & Distance", "Percentage Basics", "Average Calculation", "Area & Perimeter", "Volume Basics", "Decimal Operations"] },
        { id: 4, name: "Verbal Logic", icon: "fa-brain", time: "45 MINS", 
          passage: "Verbal Logic is the art of thinking like a master strategist and a clear communicator! It helps you understand the deep connections between words and ideas, sharpening your mind to find the absolute truth in every situation. This subject is the essential training ground for future Lawyers, Management Consultants, and strategic Diplomats who solve global problems through reasoning. By practicing logic, your mind learns how to filter through noise and present clear, powerful arguments that everyone respects. It gives you the power to influence others and lead important conversations with confidence. Sharpen your logic today and become a master of clear thinking! Understanding connections between people and events through words is a skill that will set you apart as a wise and influential person in your future professional circle. Master the art of persuasion and reasoning through this engaging topic.",
          topics: ["Coding-Decoding", "Direction Sense", "Blood Relations", "Ranking Tests", "Alphabet Series", "Number Ranking Logic", "Venn Diagrams", "Syllogism Basics", "Clock & Calendar", "Dictionary Order"] },
        { id: 5, name: "English Grammar", icon: "fa-spell-check", time: "40 MINS", 
          passage: "Grammar is the magnificent instruction manual that helps you build a powerful castle of words! In Grade 3, mastering English Grammar gives you the ability to express your biggest dreams and best ideas so perfectly that the whole world stops to listen. This skill is vital for future world-class Authors, Global Leaders, and Inspiring Speakers who change hearts and minds through their words. Every rule you master builds your inner confidence, turning you into a polished communicator who can connect with anyone, anywhere. By learning to speak and write correctly, you gain the most important tool for leadership: the power to be understood by everyone. Your ability to tell stories and share information will be your greatest asset as you grow into a leader who inspires millions with clarity and elegance. Perfect grammar is the foundation of clear communication and lifelong success.",
          topics: ["Parts Identification", "Adjective Degrees", "Tense Mastery", "Article Usage", "Preposition Logic", "Conjunction Mastery", "Subject-Verb Agreement", "Punctuation Rules", "Sentence Types", "Pronoun Reference"] },
        { id: 6, name: "Reading Comprehension", icon: "fa-book-open", time: "45 MINS", 
          passage: "Reading is a magical portal that allows you to travel through time and space from your classroom! Comprehension is the golden key that lets you understand the deepest secrets of every story, building a wise mind and an empathetic heart. These skills are essential for future Researchers, Strategic Analysts, and world-changing Journalists who seek the truth. As you practice understanding complex ideas, your mind becomes a vast library of knowledge, helping you navigate life's challenges better than anyone else. It teaches you to understand human behavior and hidden meanings, making you a more thoughtful and successful person in every walk of life. Every book you read and understand adds a new perspective to your character, helping you become a well-rounded and deeply knowledgeable global citizen of tomorrow. Dive deep into stories and learn to interpret the world with wisdom.",
          topics: ["Main Idea Extraction", "Direct Retrieval", "Inference Skills", "Vocabulary Context", "Synonym Search", "Antonym Search", "Title Selection", "Sequence of Events", "Character Analysis", "Fact vs. Opinion"] },
        { id: 7, name: "General Science", icon: "fa-microscope", time: "45 MINS", 
          passage: "Science is the grandest adventure of discovering exactly how our beautiful universe works! It nurtures your natural curiosity to understand life, space, and energy like a true scientific explorer. This subject is the launchpad for future Doctors, Aerospace Engineers, and Environmental Pioneers who will discover new cures and explore unknown planets. By asking 'How?' and 'Why?', your brain becomes an engine of discovery, teaching you how to respect nature and find creative solutions for a healthy planet. Every experiment and fact you learn today brings you closer to becoming a person who finds the answers to the world's most difficult questions. Your future in innovation and discovery starts with a single question about the world around you; never stop asking, never stop exploring. Science empowers you to change the world through knowledge and experiments.",
          topics: ["Plant Life Cycles", "Animal Kingdom", "Human Anatomy", "Nutrition Science", "The Water Cycle", "Simple Machines", "States of Matter", "Space Science", "Health & Hygiene", "Forces & Motion"] },
        { id: 8, name: "Static GK", icon: "fa-landmark", time: "30 MINS", 
          passage: "General Knowledge is the sturdy bridge that connects you to our glorious history and the wide, global family! Knowing about brave heroes, national symbols, and world wonders builds immense pride and a broad perspective on life. This foundation is essential for future Civil Servants, World Historians, and top Administrative Leaders who serve their country with wisdom and honor. Every fact you learn here adds a new lens to your eyes, helping you understand global events and preparing you for a life of leadership. Being well-informed makes you a respected citizen who can contribute meaningfully to the growth of our nation and the world. Your broad awareness will be the secret to your success in interviews and leadership roles, making you a person people turn to for guidance and knowledge. Awareness is the key to unlocking global opportunities.",
          topics: ["National Symbols", "Famous Personalities", "Important Days", "Indian States & Maps", "First in India", "Awards & Honors", "World Wonders", "Books & Authors", "Sports Awareness", "Religious Sites"] },
        { id: 9, name: "Social Studies", icon: "fa-globe-asia", time: "45 MINS", 
          passage: "Social Studies is the inspiring story of how humanity lives, works, and grows together in harmony! It teaches you about communities, civic responsibility, and the struggles of our ancestors, helping you grow into a kind and responsible world leader. These lessons are the root for future Social Policy Makers, Urban Planners, and Administrative Officers who bring positive change to society. By understanding our shared past and present, your mind learns the value of cooperation and justice, making you a person who knows exactly how to help everyone thrive. It builds your character and teaches you how to be a part of something bigger than yourself. Your understanding of diversity and community will help you create a world where every person feels valued and connected. Discover the beauty of human connections and societal growth.",
          topics: ["Earth Structure", "Freedom Struggle", "Civic Duties", "Landforms & Terrain", "Climate Zones", "Transport History", "Communication Modes", "Ancient Civilizations", "Local Government", "Maps & Globes"] },
        { id: 10, name: "Data Handling", icon: "fa-chart-bar", time: "45 MINS", 
          passage: "We live in an age of 'Big Data', and knowing how to handle it is like having a real-life superpower! For 3rd graders, learning to organize information into charts and graphs teaches you how to visualize big truths and make smart, fact-based choices every single day. This skill is critical for future AI Specialists, Statisticians, and Business Strategy Analysts who drive the modern world's economy. Every chart you read sharpens your ability to filter through noise and see the core facts, ensuring you always make the most intelligent decisions. Mastering data today means you will be the one who leads the digital technology revolution of tomorrow! Your ability to translate numbers into stories and decisions will make you an indispensable asset in the data-driven world of the future. Learn to harness the power of information to create a better tomorrow.",
          topics: ["Pictograph Reading", "Bar Graphs Mastery", "Tally Marks Logic", "Table Interpretation", "Circle Graphs (Pie)", "Mean/Average Logic", "Range Discovery", "Pattern Analysis", "Recording Data", "Probability Basics"] }
    ];

    const monthsData = ["JUNE", "JULY", "AUGUST", "SEPTEMBER", "OCTOBER", "NOVEMBER", "DECEMBER", "JANUARY", "FEBRUARY", "MARCH"];
    
    const container = document.getElementById('subjects-container');
    subjectsData.forEach(sub => {
        let subjectHtml = `
            <div class="subject-pane">
                <div class="sub-head-row">
                    <i class="fa-solid ${sub.icon}"></i>
                    <h3>${sub.id}. ${sub.name}</h3>
                </div>
                <div class="sub-inspiration">${sub.passage}</div>
        `;

        sub.topics.forEach((topic, idx) => {
            const sheetName = `3S${sub.id}T${idx + 1}`;
            subjectHtml += `
                <div class="item-row">
                    <div class="item-top">
                        <span class="item-month">${monthsData[idx]}</span>
                        <div class="item-meta">
                            <span><i class="fa-solid fa-clock"></i> ${sub.time}</span>
                            <span><i class="fa-solid fa-list-ol"></i> 30 QS</span>
                            <span><i class="fa-solid fa-star"></i> 30 MARKS</span>
                            <span><i class="fa-solid fa-redo"></i> 3 ATTEMPTS</span>
                        </div>
                        <div class="item-scores">
                            <span class="score-lbl">Results:</span>
                            <div class="box-grid">
                                <div class="box-unit">--</div>
                                <div class="box-unit">--</div>
                                <div class="box-unit">--</div>
                            </div>
                        </div>
                    </div>
                    <div class="item-bottom">
                        <div class="item-topic-name"><span>Topic:</span> ${topic}</div>
                        <button onclick="openExam('${sheetName}', '${topic}', '${sub.time}')" class="btn-take">EXAM</button>
                    </div>
                </div>`;
        });
        subjectHtml += `</div>`;
        container.innerHTML += subjectHtml;
    });

    let currentQuestions = [];
    let userSelections = {};
    let timerInterval = null;
    let secondsLeft = 0;

    async function openExam(sheetName, topic, durationStr) {
        document.getElementById('exam-overlay').style.display = 'flex';
        document.body.style.overflow = 'hidden';
        document.getElementById('modal-topic-title').innerText = topic;
        document.getElementById('modal-body').innerHTML = `<div style="text-align:center; padding-top:50px;"><i class="fas fa-circle-notch fa-spin" style="font-size:30px; color:#00008B;"></i><p style="margin-top:10px; font-weight:700;">Preparing Questions...</p></div>`;
        
        userSelections = {};
        const mins = parseInt(durationStr);
        secondsLeft = mins * 60;
        updateTimerDisplay();

        try {
            const response = await fetch(`${API_URL}?action=getQuestions&sheetName=${sheetName}`);
            const data = await response.json();
            currentQuestions = data; 
            renderQuestions();
            startTimer();
        } catch (error) {
            document.getElementById('modal-body').innerHTML = `<p style="color:red; text-align:center; padding:20px;">Error Loading Data. Please check connection.</p>`;
        }
    }

    function renderQuestions() {
        let html = '';
        currentQuestions.forEach((q, qIdx) => {
            html += `
                <div class="question-card">
                    <div class="q-text"><span class="q-num-badge">${q.id}</span> ${q.question}</div>
                    <div class="options-list">
                        ${q.options.map((opt, oIdx) => `
                            <div class="option-item" id="q${qIdx}o${oIdx}" onclick="selectOption(${qIdx}, ${oIdx}, '${opt}')">
                                ${String.fromCharCode(65 + oIdx)}. ${opt}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        });
        html += `
            <div class="footer-action-area">
                <button class="btn-submit" onclick="submitTest()">Submit Exam</button>
            </div>
        `;
        document.getElementById('modal-body').innerHTML = html;
        document.getElementById('modal-body').scrollTo(0,0);
    }

    function selectOption(qIdx, oIdx, val) {
        const count = currentQuestions[qIdx].options.length;
        for(let i=0; i<count; i++) {
            const el = document.getElementById(`q${qIdx}o${i}`);
            if(el) el.classList.remove('selected');
        }
        document.getElementById(`q${qIdx}o${oIdx}`).classList.add('selected');
        userSelections[qIdx] = val;
    }

    function startTimer() {
        clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            secondsLeft--;
            updateTimerDisplay();
            if (secondsLeft <= 300) document.getElementById('timer-group').classList.add('timer-urgent');
            if (secondsLeft <= 0) { clearInterval(timerInterval); submitTest(true); }
        }, 1000);
    }

    function updateTimerDisplay() {
        const m = Math.floor(secondsLeft / 60);
        const s = secondsLeft % 60;
        const mStr = m.toString().padStart(2, '0');
        const sStr = s.toString().padStart(2, '0');
        document.getElementById('m1').innerText = mStr[0];
        document.getElementById('m2').innerText = mStr[1];
        document.getElementById('s1').innerText = sStr[0];
        document.getElementById('s2').innerText = sStr[1];
    }

    function submitTest(isAuto = false) {
        clearInterval(timerInterval);
        let score = 0;
        currentQuestions.forEach((q, idx) => {
            if (userSelections[idx] === q.correctAnswer) score++;
        });

        const percent = (score / currentQuestions.length) * 100;
        let feedback = "";
        let color = "";
        let motivation = "";
        
        if (percent === 100) { feedback = "EXCELLENT!"; color = "var(--success)"; motivation = "You are a true genius! Perfect score achieved. Your hard work is paving the way for a spectacular future."; }
        else if (percent >= 85) { feedback = "VERY GOOD!"; color = "var(--primary)"; motivation = "Fantastic job! You've mastered almost everything. Keep this momentum going to reach perfection."; }
        else if (percent >= 50) { feedback = "GOOD"; color = "#334155"; motivation = "Well done! You have a solid understanding. A little more practice will make you unstoppable."; }
        else { feedback = "NEEDS IMPROVEMENT"; color = "var(--danger)"; motivation = "Don't give up! Every mistake is a step toward learning. Review your answers and try again to improve."; }

        document.getElementById('modal-body').innerHTML = `
            <div class="result-screen">
                <div class="score-circle" style="border-color:${color}"><span class="score-val" style="color:${color}">${score}/${currentQuestions.length}</span></div>
                <h2 class="feedback-text" style="color:${color}">${feedback}</h2>
                <p class="feedback-msg"><strong>All the best for the next attempt!</strong><br>${motivation}</p>
                <div class="result-buttons">
                    <button class="btn-res-action btn-res-review" onclick="viewReview()">
                        <i class="fa-solid fa-magnifying-glass"></i> Review Answers
                    </button>
                    <button class="btn-res-action btn-res-close" onclick="closeExam()">
                        <i class="fa-solid fa-circle-xmark"></i> Close & Exit
                    </button>
                </div>
            </div>
        `;
        document.getElementById('modal-body').scrollTo(0,0);
    }

    function viewReview() {
        let html = `<h2 style="text-align:center; margin-bottom:20px; font-weight:900; font-size:18px; color:var(--primary); text-transform:uppercase;">Performance Review Report</h2>`;
        
        currentQuestions.forEach((q, idx) => {
            const userAns = userSelections[idx] || 'Not Answered';
            const isCorrect = userAns === q.correctAnswer;
            html += `
                <div class="review-card">
                    <div class="q-text" style="font-size:14px; margin-bottom:5px;"><span class="q-num-badge">${q.id}</span> ${q.question}</div>
                    <div class="ans-row">User Choice: <span class="${isCorrect ? 'ans-correct' : 'ans-wrong'}">${userAns}</span></div>
                    ${!isCorrect ? `<div class="ans-row">Correct Answer: <span class="ans-correct">${q.correctAnswer}</span></div>` : ''}
                    <div class="explanation-box"><strong>Explanation:</strong> ${q.explanation || 'Review logic for this question.'}</div>
                </div>
            `;
        });

        html += `
            <div style="text-align:center; padding:30px;">
                <button class="btn-res-action btn-res-close" style="margin:0 auto;" onclick="closeExam()">
                    <i class="fa-solid fa-circle-xmark"></i> Close Review
                </button>
            </div>
        `;
        document.getElementById('modal-body').innerHTML = html;
        document.getElementById('modal-body').scrollTo(0,0);
    }

    function closeExam() {
        clearInterval(timerInterval);
        document.getElementById('exam-overlay').style.display = 'none';
        document.body.style.overflow = 'auto';
        document.getElementById('modal-body').innerHTML = "";
        document.getElementById('modal-topic-title').innerText = "Loading...";
    }
</script>

</body>
</html>
